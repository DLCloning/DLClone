
# SIMIAN

You can run the following command.
To speed up the process you can create different files based on the number of cloned lines (setting --min --max paramters). The function will create the xlsx files for the output

## INPUT PARAMETERS
--simian: the path to the file generated by simian
--file_dir: the path of the training files (with the separator between them to avoid that a clone could involve more than one method) and their mapping file
--pretraining_dir: the path of the pretraining files (with the separator between them to avoid that a clone could involve more than one method) and their mapping file
--id_folder: the path to the folder containing all the information about the method id and masked method id
--predictions: the path to the predictions and their mapping file
--test_method: the path to the test methods (we used T5 to predict specific blocks (around 15700) belonging to 8604 different test methods)
--target: the path to the oracles (the block we would like the model to predict)
--output_excel: the output file name
--min: the minimum length we want to consider (3 means that all the clones must have at least 3 lines cloned)
--max: the maximum length we want to consider (3 means that all the clones must have at most 3 lines cloned)

## OUTPUT PARAMETERS
Clone ID: the ID of the cluster of clones (clones with the same Clone ID belong to the same cluster)
Internal ID: ID internal of the method (starting from 0 to the number of samples). if ID Internal is 30010, since we kept 30k methods for each file, it the 11th method of the second file (file_1.java)
Num Lines: number of cloned lines (simian reported this number)
File: file in which simian found the clone. The file with "prediction" in the name is the file with the predictions of T5, if it contains "pretraining" it is from pretraining, otherwise from training set
Start Line: the starting line of the clone (e.g. 49423). We can use the mapping file we created in 24/2 to map this line to a specific method in pretraining/training/prediction
End Line: the ending line of the clone
Cloned Part: the lines that have been cloned
Code checked for duplicate: it contains the whole method that contain the clone for pretraining and training dataset, the entire T5's prediction for the predictions
Correct prediction: the oracle (the prediction we would like to receive for having a perfect prediction)
Test method: the test method (the entire method containing the oracle)
Method id: the method ID we get from ID folder (at the beginning we enumerated the methods when we mined the dataset for 001)
Masked method id: the method ID we get from ID folder (at the beginning we enumerated the masked methods when we mined the dataset for 001)

# HOW TO CHECK IF A FILE IS CORRECT
320819	453629	3	file_15.java	47932	47934		"for (int j = 0; j < result.size(); j++) {			644354
													Object obj = result.get(j);
													fullResult.putUsingUnderlying(obj, obj);"
320819	5006	       3	file_prediction_0.java	32808	32810	"for (int j = 0; j < result.size(); j++) {		233115	824899
													Object obj = result.get(j);
													fullResult.putUsingUnderlying(obj, obj);"

For the clone ID 320819 we have two different elements. The cloned part of each part must be the same.
The first one is in the file_15.java from line 47932 to line 47934. The ID (starting from 0) is 453629. This means that it is the 3630th method of file_15.
You can look at the map file for training (24/2/0807) to check if the element line 15_453629 contains the start and end lines (15_453629_47916_47955).
The same thing must be done for prediction file (24/2/0807/predictions) (0_5006_32805_32812)
The first element has as method id 644354 and if you look for this method id in 22/14/0807/train_masked_and_method.txt) you will find 3 lines (681306 to 681308). You can look at train.tsv in the same folder and check the 3 previous rows (if the method is the one reported in `Code checked for duplicates` column.
You can now check the predictions. The ID of the prediction is 5006 (5007th prediction) so you can check the 5007th line in 22/14/0807/test_masked_and_methods.txt (   824899|||233115, like method id and masked_method_id).
Now you can look at the 5007th prediction in inp/23/5/0807/predictions.txt-648800 to see if it is equal to the value reported in `Code checked for duplicates`. Then you need to check if the cloned part is inside this text.
Finally you need to look for the 5007th oracle (inp/23/5/finetuning_targets) and see if it is equal to the `correct prediction` column. Then you need to check if the correct prediction is contained in the test_method.
Last check: the method id for prediction is 233115 that is the 2394th line in out/22/14/0807/test_methods.txt. So if you look at the 2394th line of inp/24/2/0807/targets file you have to see the target code
For pretraining dataset you can do the same tests done for training files (but we don't have any method id)


Example script:

```
python3 clone_analysis_Simian_v6.py --simian="simian.txt" --file_dir="0302" --pretraining_dir="prepare_for_cloning/pretraining" --id_folder "dataset_0302" --predictions="0302/predictions"   --test_method="prepare_for_cloning/0302/test_methods" --target="prepare_for_cloning/0302/targets" --output_excel "files3.xlsx"  --min 3 --max 3
```


# PACKAGES
openpyxl lxml